#!/usr/bin/python

from __future__ import print_function
import shutil
import subprocess
import sys
try:
    from urlparse import urlparse
except ImportError:
    from urllib.parse import urlparse


action = sys.argv[1]
uri_arg = sys.argv[2]
if len(sys.argv) > 3:
    target_dir = sys.argv[3]
    target_file = target_dir+'/neo4j-package.tar.gz'

if not action in ['sha', 'copy', 'uri']:
    sys.exit("Unknown action %s" % action)

uri = urlparse(uri_arg)

if uri.scheme == 'file':
    path = uri.path
    if action == 'sha':
        result = subprocess.check_output(['shasum', '--algorithm=256', path])
        sha = result.split()[0]
        print(sha.decode())
    elif action == 'copy':
        shutil.copy(path, target_file)
    elif action == 'uri':
        print('file:///tmp/neo4j-package.tar.gz')
else:
    if action == 'sha':
        result = subprocess.check_output("curl --silent %s | shasum --algorithm=256" % uri_arg,
                                         shell=True)
        sha = result.split()[0]
        print(sha.decode())
    elif action == 'copy':
        pass
    elif action == 'uri':
        print(uri_arg)
